<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CARTOGRAFFECT</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
        }
        .chart-container {
            background-color: #1e293b; /* bg-slate-800 */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            position: relative;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            background: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            border-radius: 6px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .controls {
            margin-bottom: 20px;
            text-align: center;
        }
        #animateBtn {
            padding: 10px 20px;
            font-size: 16px;
            font-weight: 600;
            background-color: #6366f1; /* indigo-500 */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #animateBtn:hover {
            background-color: #4f46e5; /* indigo-600 */
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300">

    <div class="container mx-auto px-4 py-12">

        <header class="h-screen flex flex-col items-center justify-center text-center p-4 -mt-12">
            <h1 class="text-6xl md:text-8xl lg:text-9xl font-bold text-indigo-400 tracking-tighter">
                CARTOGRAFFECT
            </h1>
            <p class="text-xl md:text-2xl mt-4 text-slate-400">
                Explorez la carte de vos émotions
            </p>
        </header>

        <main class="py-16">
            <section class="text-center mb-24">
                <p class="text-xl md:text-2xl max-w-4xl mx-auto leading-relaxed text-slate-400">
                    Bienvenue. L'objectif de ce site est de vous aider à <strong>cartographier les émotions pour mieux se comprendre</strong>. En explorant les différents territoires de votre monde intérieur, vous développerez une meilleure conscience de vous-même et trouverez des chemins vers un plus grand équilibre.
                </p>
            </section>

            <section class="mb-24 text-center">
                <canvas id="textCanvas" style="display: none;"></canvas>
                <div class="chart-container max-w-4xl mx-auto" style="height: 250px;">
                    <svg id="genericChart" class="w-full h-full"></svg>
                </div>
            </section>

            <section class="grid md:grid-cols-3 gap-10">
                <!-- Territoire 1: ÉMOTIONS -->
                <div class="bg-slate-800/50 border border-slate-700 p-8 rounded-2xl shadow-lg flex flex-col transition duration-300 hover:border-blue-500/50 hover:-translate-y-2">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-blue-400 mb-4">Territoire 1 : ÉMOTIONS</h2>
                        <p class="mb-8 text-slate-400"><strong>Les Fondations de la Carte.</strong><br>Cette section explique les éléments de base de votre carte : ce que sont les émotions, leur utilité, etc.</p>
                    </div>
                    <a href="emotions.html" class="mt-auto inline-block bg-blue-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors text-center">Explorer les Émotions</a>
                </div>

                <!-- Territoire 2: CRIMES -->
                <div class="bg-slate-800/50 border border-slate-700 p-8 rounded-2xl shadow-lg flex flex-col transition duration-300 hover:border-purple-500/50 hover:-translate-y-2">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-purple-400 mb-4">Territoire 2 : CRIMES</h2>
                        <p class="mb-8 text-slate-400"><strong>Les Zones d'Ombre de la Carte.</strong><br>Cette section décrit les "territoires difficiles" ou les schémas comportementaux résultant d'une navigation émotionnelle compliquée.</p>
                    </div>
                    <a href="crimes.html" class="mt-auto inline-block bg-purple-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors text-center">Découvrir les Zones d'Ombre</a>
                </div>

                <!-- Territoire 3: MIRACLES -->
                <div class="bg-slate-800/50 border border-slate-700 p-8 rounded-2xl shadow-lg flex flex-col transition duration-300 hover:border-green-500/50 hover:-translate-y-2">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-green-400 mb-4">Territoire 3 : MIRACLES</h2>
                        <p class="mb-8 text-slate-400"><strong>Les Itinéraires vers l'Équilibre.</strong><br>Ici, vous proposez les "itinéraires" ou les "boussoles" pour mieux naviguer.</p>
                    </div>
                    <a href="miracles.html" class="mt-auto inline-block bg-green-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-green-600 transition-colors text-center">Trouver son Itinéraire</a>
                </div>
            </section>
        </main>

        <footer class="text-center mt-16 text-slate-500">
            <p>&copy; 2024 Cartograffect.</p>
        </footer>

    </div>

    <script>
        function getTextCoordinates() {
            const canvas = document.getElementById('textCanvas');
            const context = canvas.getContext('2d', { willReadFrequently: true });

            const svgWidth = 700;
            const svgHeight = 250;
            canvas.width = svgWidth;
            canvas.height = svgHeight;

            context.fillStyle = "white";
            context.font = "bold 120px 'DM Sans', sans-serif";
            context.textAlign = "center";
            context.textBaseline = "middle";
            context.fillText("CARTOGRAFFECT", svgWidth / 2, svgHeight / 2);

            const imageData = context.getImageData(0, 0, svgWidth, svgHeight);
            const pixelData = imageData.data;

            const coordinates = [];
            const sampling = 4; // Sample every 4th pixel to reduce density

            for (let y = 0; y < svgHeight; y += sampling) {
                for (let x = 0; x < svgWidth; x += sampling) {
                    const index = (y * svgWidth + x) * 4;
                    // Check the alpha channel
                    if (pixelData[index + 3] > 128) {
                        coordinates.push({ x: x, y: y });
                    }
                }
            }
            return coordinates;
        }

        // --- Main D3 Logic ---
        document.addEventListener("DOMContentLoaded", () => {
            const textCoords = getTextCoordinates();
            let pointsData = [];

            const margin = { top: 0, right: 0, bottom: 0, left: 0 };

            // Use the container's full size
            const container = d3.select(".chart-container");
            const width = container.node().getBoundingClientRect().width - margin.left - margin.right;
            const height = container.node().getBoundingClientRect().height - margin.top - margin.bottom;

            const svg = d3.select("#genericChart")
                .attr("viewBox", `0 0 ${width} ${height}`) // Use viewBox for responsiveness
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const colorGroups = {
                "Joie": "#fde047", "Tristesse": "#93c5fd", "Peur": "#c084fc", "Courage": "#86efac",
                "Colère": "#fca5a5", "Calme": "#67e8f9", "Désir": "#f9a8d4", "Dégoût": "#9ca3af",
                "Orientation": "#a5b4fc"
            };
            const colorKeys = Object.keys(colorGroups);
            const colorScale = d3.scaleOrdinal().domain(colorKeys).range(Object.values(colorGroups));

            // Shuffle the target coordinates for a more dynamic animation
            const shuffledTextCoords = d3.shuffle(textCoords.slice());

            // Prepare data points
            for(let i = 0; i < shuffledTextCoords.length; i++) {
                pointsData.push({
                    // Start at a random position
                    x: Math.random() * width,
                    y: Math.random() * height,
                    // Assign target coordinates from the shuffled text data
                    targetX: shuffledTextCoords[i].x,
                    targetY: shuffledTextCoords[i].y,
                    // Assign a color group cyclically
                    group: colorKeys[i % colorKeys.length]
                });
            }

            // Draw the points
            const points = svg.selectAll(".data-point")
                .data(pointsData)
                .enter().append("circle")
                .attr("class", "data-point")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", 2) // Smaller radius for a more detailed text effect
                .attr("fill", d => colorScale(d.group))
                .style("opacity", 0.7);

            // Animation function
            function animateToText() {
                points.transition()
                    .duration(2500) // Slower transition to be more graceful
                    .delay((d, i) => i * 1.5) // Stagger the start of each point's animation
                    .ease(d3.easeCubicInOut)
                    .attr("cx", d => d.targetX)
                    .attr("cy", d => d.targetY);
            }

            // Start the animation after a short delay on page load
            setTimeout(animateToText, 500);
        });

    </script>

</body>
</html>
