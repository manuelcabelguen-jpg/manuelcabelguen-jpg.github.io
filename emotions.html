<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CARTOGRAFFECT</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
        }
        .chart-container {
            background-color: transparent;
            position: relative;
            width: 100%;
            height: 100%;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            background: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            border-radius: 6px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300">

    <div class="container mx-auto px-4">

        <header class="h-screen flex flex-col items-center justify-center text-center">
            <!-- Animation is now the hero content -->
            <div class="chart-container">
                <canvas id="textCanvas" style="display: none;"></canvas>
                <svg id="genericChart" class="w-full h-full"></svg>
            </div>
        </header>

        <main class="py-16">
            <section class="text-center mb-24">
                <p class="text-xl md:text-2xl max-w-4xl mx-auto leading-relaxed text-slate-400">
                    Bienvenue. L'objectif de ce site est de vous aider à <strong>cartographier les émotions pour mieux se comprendre</strong>. En explorant les différents territoires de votre monde intérieur, vous développerez une meilleure conscience de vous-même et trouverez des chemins vers un plus grand équilibre.
                </p>
            </section>

            <section class="grid md:grid-cols-3 gap-10">
                <!-- Territoire 1: ÉMOTIONS -->
                <div class="bg-slate-800/50 border border-slate-700 p-8 rounded-2xl shadow-lg flex flex-col transition duration-300 hover:border-blue-500/50 hover:-translate-y-2">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-blue-400 mb-4">Territoire 1 : ÉMOTIONS</h2>
                        <p class="mb-8 text-slate-400"><strong>Les Fondations de la Carte.</strong><br>Cette section explique les éléments de base de votre carte : ce que sont les émotions, leur utilité, etc.</p>
                    </div>
                    <a href="emotions.html" class="mt-auto inline-block bg-blue-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors text-center">Explorer les Émotions</a>
                </div>

                <!-- Territoire 2: CRIMES -->
                <div class="bg-slate-800/50 border border-slate-700 p-8 rounded-2xl shadow-lg flex flex-col transition duration-300 hover:border-purple-500/50 hover:-translate-y-2">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-purple-400 mb-4">Territoire 2 : CRIMES</h2>
                        <p class="mb-8 text-slate-400"><strong>Les Zones d'Ombre de la Carte.</strong><br>Cette section décrit les "territoires difficiles" ou les schémas comportementaux résultant d'une navigation émotionnelle compliquée.</p>
                    </div>
                    <a href="crimes.html" class="mt-auto inline-block bg-purple-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-purple-600 transition-colors text-center">Découvrir les Zones d'Ombre</a>
                </div>

                <!-- Territoire 3: MIRACLES -->
                <div class="bg-slate-800/50 border border-slate-700 p-8 rounded-2xl shadow-lg flex flex-col transition duration-300 hover:border-green-500/50 hover:-translate-y-2">
                    <div class="flex-grow">
                        <h2 class="text-2xl font-bold text-green-400 mb-4">Territoire 3 : MIRACLES</h2>
                        <p class="mb-8 text-slate-400"><strong>Les Itinéraires vers l'Équilibre.</strong><br>Ici, vous proposez les "itinéraires" ou les "boussoles" pour mieux naviguer.</p>
                    </div>
                    <a href="miracles.html" class="mt-auto inline-block bg-green-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-green-600 transition-colors text-center">Trouver son Itinéraire</a>
                </div>
            </section>
        </main>

        <footer class="text-center mt-16 text-slate-500">
            <p>&copy; 2024 Cartograffect.</p>
        </footer>

    </div>

    <script>
        function getTextCoordinates(width, height) {
            const canvas = document.getElementById('textCanvas');
            const context = canvas.getContext('2d', { willReadFrequently: true });
            canvas.width = width;
            canvas.height = height;

            // Responsive font size - calculated to fit the word in the container
            const fontSize = Math.min(width / 10, height / 1.5); 

            context.fillStyle = "white";
            context.font = `bold ${fontSize}px 'DM Sans', sans-serif`;
            context.textAlign = "center";
            context.textBaseline = "middle";
            context.fillText("CARTOGRAFFECT", width / 2, height / 2);

            const imageData = context.getImageData(0, 0, width, height);
            const pixelData = imageData.data;
            const coordinates = [];
            
            // Adjust sampling based on screen size to maintain density
            const sampling = width > 768 ? 4 : 3; 

            for (let y = 0; y < height; y += sampling) {
                for (let x = 0; x < width; x += sampling) {
                    const index = (y * width + x) * 4;
                    if (pixelData[index + 3] > 128) {
                        coordinates.push({ x: x, y: y });
                    }
                }
            }
            return coordinates;
        }

        document.addEventListener("DOMContentLoaded", () => {
            const container = d3.select(".chart-container");
            const width = container.node().getBoundingClientRect().width;
            const height = container.node().getBoundingClientRect().height;

            const textCoords = getTextCoordinates(width, height);
            let pointsData = [];
            
            const svg = d3.select("#genericChart")
                .attr("viewBox", `0 0 ${width} ${height}`)
                .append("g");

            const colorGroups = {
                "Joie": "#fde047", "Tristesse": "#93c5fd", "Peur": "#c084fc", "Courage": "#86efac",
                "Colère": "#fca5a5", "Calme": "#67e8f9", "Désir": "#f9a8d4", "Dégoût": "#9ca3af",
                "Orientation": "#a5b4fc"
            };
            const colorKeys = Object.keys(colorGroups);
            const colorScale = d3.scaleOrdinal().domain(colorKeys).range(Object.values(colorGroups));
            
            const shuffledTextCoords = d3.shuffle(textCoords.slice());

            for(let i = 0; i < shuffledTextCoords.length; i++) {
                pointsData.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    targetX: shuffledTextCoords[i].x,
                    targetY: shuffledTextCoords[i].y,
                    group: colorKeys[i % colorKeys.length]
                });
            }

            const points = svg.selectAll(".data-point")
                .data(pointsData)
                .enter().append("circle")
                .attr("class", "data-point")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", 2)
                .attr("fill", d => colorScale(d.group))
                .style("opacity", 0.8);

            function animateToText() {
                points.transition()
                    .duration(1500) // Reduced duration
                    .delay((d, i) => i * 0.75) // Reduced stagger delay
                    .ease(d3.easeCubicInOut)
                    .attr("cx", d => d.targetX)
                    .attr("cy", d => d.targetY);
            }

            // Use a timeout to ensure the animation starts after the page is fully laid out
            setTimeout(animateToText, 100);
        });
    </script>

</body>
</html>
